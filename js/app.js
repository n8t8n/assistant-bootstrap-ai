import{bootstrapMethods}from"./methods.js";new Vue({el:"#app",data:{message:"",chatLog:[],messages:[],apiKey:"",saveApiKey:!1,isLoading:!0,selectedModel:"hf:Qwen/Qwen2.5-Coder-32B-Instruct",typingMessage:"# Welcome to My Custom Bootstrap 5 + Vue CDN Generator! \n\nPowered by the **Glhf.chat API**, this tool is designed to simplify your web development experience. \n\nUse exclusively with model ```Qwen2.5-Coder-32B-Instruct.``` \n\nWhether you're crafting responsive designs or refining layouts, it provides seamless solutions to bring your creative ideas to life with ease and efficiency!",typingIndex:0,typingInterval:null,currentTypingElement:null,payloadLimit:10,contexto:'You are a frontend static developer. You generate bootstrap 5 code using only the following local CDNs for Bootstrap resources: <script src="https://unpkg.com/vue@3"><\/script><link rel="stylesheet" href="http://127.0.0.1:8000/node_modules/bootstrap/dist/css/bootstrap.css"> <link rel="stylesheet" href="http://127.0.0.1:8000/node_modules/bootstrap-icons/font/bootstrap-icons.css"> <script src="http://127.0.0.1:8000/node_modules/bootstrap/dist/js/bootstrap.bundle.js"><\/script>. Be a perfect machine concise that focus in code responses, not rich text, never rich text, never plain text code.'},methods:{activateApiKey(){""===this.apiKey.trim()?this.showModalAlert("Please enter an API Key.","dark"):(this.saveApiKey?(localStorage.setItem("apiKey",this.apiKey),localStorage.setItem("contexto",this.contexto)):(localStorage.removeItem("apiKey"),localStorage.removeItem("contexto")),this.showModalAlert("API Key and Contexto Activated!","dark"),console.log("API Key Activated:",this.apiKey),console.log("Contexto Activated:",this.contexto))},loadApiKey(){var e=localStorage.getItem("apiKey"),e=(e&&(this.apiKey=e),localStorage.getItem("contexto"));e&&(this.contexto=e)},showModalAlert(e,t="primary"){let s=document.createElement("div");s.className=`rounded-4 alert alert-${t} alert-dismissible fade show`,s.role="alert",s.innerHTML=`
        ${e}
        <button type="button" class="btn-close shadow-none" data-bs-dismiss="alert" aria-label="Close"></button>
      `,document.getElementById("alertContainer").appendChild(s),setTimeout(()=>{s.classList.remove("show"),setTimeout(()=>s.remove(),150)},1500)},clearApiKey(){localStorage.removeItem("apiKey"),localStorage.removeItem("contexto"),this.apiKey="",this.contexto="",this.saveApiKey=!1,this.showModalAlert("API Key and Context cleared successfully.","dark")},...bootstrapMethods,handleInput(e){this.message=e.target.innerText},handleKeydown(e){var t,s,o;"Enter"===e.key&&(window.innerWidth<900?(e.preventDefault(),this.$refs.messageInput,s=(t=window.getSelection()).getRangeAt(0),o=document.createElement("br"),s.deleteContents(),s.insertNode(o),s.setStartAfter(o),s.setEndAfter(o),t.removeAllRanges(),t.addRange(s)):(e.preventDefault(),this.sendMessage()))},async sendMessage(){var s=localStorage.getItem("userIP"),o=localStorage.getItem("lastMessageTimestamp"),a=(new Date).getTime(),o=(o&&a-18e5>parseInt(o,10)&&localStorage.setItem("messageCount",0),parseInt(localStorage.getItem("messageCount"),10)||0);if(o>=this.payloadLimit)this.showModalAlert("You have exceeded the usage limit. Please try again later.","dark");else{if(!s)try{var r=await(await fetch("https://ipapi.co/json/")).json();localStorage.setItem("userIP",r.ip)}catch(e){return console.error("Error fetching user IP:",e),void this.showModalAlert("Could not determine your IP address. Please try again later.","dark")}if(this.apiKey.trim()){console.log("Using API Key:",this.apiKey);s=this.$refs.messageInput;if(s&&s.innerText.trim()){r=s.innerText.trim(),s=(s.innerText="",0===this.messages.length&&this.messages.push({role:"system",content:this.contexto}),{role:"user",content:r}),r={role:"user",content:r},s=(this.chatLog.push(s),this.messages.push(r),this.message="",{Authorization:"Bearer "+this.apiKey,"Content-Type":"application/json"}),r={stream:!0,messages:this.messages,model:this.selectedModel};try{var i=await fetch("https://glhf.chat/api/openai/v1/chat/completions",{method:"POST",headers:s,body:JSON.stringify(r)});if(!i.ok)throw console.error("API request failed with status:",i.status),new Error("API request failed: "+i.statusText);var n=i.body.getReader(),l=new TextDecoder("utf-8");let e=!1,t="";for(;!e;){var c,{value:h,done:d}=await n.read();e=d;for(c of l.decode(h,{stream:!e}).split("\n").filter(e=>""!==e.trim())){var p="data: ";if(c.startsWith(p)){var g=c.slice(p.length);if("[DONE]"===g)break;var m=JSON.parse(g).choices[0].delta.content;m&&(t+=m,this.$nextTick(()=>{var e=this.$refs.chatLog;e.scrollTop=e.scrollHeight}))}}}var y={role:"assistant",content:t,showPreview:!1};this.chatLog.push(y),this.messages.push(y),localStorage.setItem("messageCount",o+1),localStorage.setItem("lastMessageTimestamp",a.toString()),this.$nextTick(()=>{var e=this.$refs.chatLog;e.scrollTop=e.scrollHeight,this.clearTypingEffect()})}catch(e){console.error("Error during API request:",e),this.chatLog.push({role:"assistant",content:"Error: Could not connect to the server."}),this.clearTypingEffect()}}else this.showModalAlert("Message cannot be empty.","dark")}else this.showModalAlert("API Key is missing. Please activate the API Key.","dark")}},startTypingEffect(t,s){s&&(this.typingIndex=0,(this.currentTypingElement=s).innerHTML="",s.style.opacity=1,this.typingInterval&&clearInterval(this.typingInterval),this.typingInterval=setInterval(()=>{var e;this.typingIndex<t.length?(e=t.charAt(this.typingIndex),s.innerHTML+="\n"===e?"<br>":e,this.typingIndex++):(clearInterval(this.typingInterval),s.innerHTML=this.formatMessage(t,0))},5))},clearTypingEffect(){this.currentTypingElement&&(this.currentTypingElement.textContent="",this.currentTypingElement.style.opacity=0),this.typingInterval&&clearInterval(this.typingInterval)},displayMessageWithTypingEffect(t,e){let s={role:e,content:t,isTyping:!0};this.chatLog.push(s),this.$nextTick(()=>{var e=this.$refs.chatLog,e=(e.scrollTop=e.scrollHeight,e.lastElementChild.querySelector(".message"));e?this.startTypingEffect(t,e):console.error("Message element not found for typing effect."),setTimeout(()=>{s.isTyping=!1},40*t.length+100)})},addCopyButtons(){document.querySelectorAll('pre code[class^="language-"]').forEach(t=>{var e=document.createElement("button"),s=(e.className="px-2 copy-button btn bg-light",e.innerHTML='Copy <i class="bi bi-clipboard"></i>',e.addEventListener("click",()=>{var e=t.textContent;navigator.clipboard.writeText(e).then(()=>{this.showModalAlert("Code copied to clipboard!","success")}).catch(e=>{console.error("Failed to copy text: ",e),this.showModalAlert("Failed to copy code.","danger")})}),document.createElement("div"));s.className="text-end position-relative",s.style.marginBottom="-37px",s.style.marginRight="-2px",s.style.fontSize="0px",s.appendChild(e),t.parentNode.insertBefore(s,t)})}},mounted(){var e=document.createElement("link");e.rel="stylesheet",e.href="css/custom-style.css",document.head.appendChild(e),fetch("node_modules/marked/marked.min.js").then(e=>{if(e.ok)return e.text();throw new Error("Network response was not ok "+e.statusText)}).then(e=>{var t=document.createElement("script");t.textContent=e,document.head.appendChild(t),marked.setOptions({highlight:function(e,t){return e},langPrefix:"hljs language-",breaks:!0,gfm:!0}),this.isLoading=!1}).catch(e=>{console.error("Error loading marked.min.js:",e),this.isLoading=!1}),this.loadApiKey(),this.addCopyButtons()},updated(){var e=this.$refs.chatLog;e.scrollTop=e.scrollHeight,this.$nextTick(()=>{this.startTypingEffect(this.typingMessage,document.getElementById("typing-effect"))}),this.addCopyButtons()},...bootstrapMethods});